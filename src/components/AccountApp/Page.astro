---
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import LanguageSwitcher from "@/components/LanguageSwitcher.astro";
import { useTranslations, type Language } from "@/i18n/translations";

// Detect language from URL path
const pathname = Astro.url.pathname;
const lang: Language =
  pathname.startsWith("/fr/") ||
  pathname === "/fr" ||
  pathname.startsWith("/fr/account")
    ? "fr"
    : "en";
const t = useTranslations(lang);
---

<Layout
  title={t.seo.account.title}
  description={t.seo.account.description}
  lang={lang}
>
  <Header lang={lang} />
  <LanguageSwitcher lang={lang} />

  <main class="pt-24 pb-12 min-h-screen bg-gray-100">
    <div class="max-w-3xl mx-auto px-6">
      <!-- Loading State -->
      <div id="loading-container" class="text-center py-12">
        <div
          class="inline-block animate-spin rounded-full h-10 w-10 border-b-2 border-brand-blue-500 mb-3"
        >
        </div>
        <p class="text-gray-500 text-sm">{t.account.loading}</p>
      </div>

      <!-- Account Info -->
      <div id="account-container" class="hidden">
        <!-- Header -->
        <div class="mb-8 text-center">
          <h1 class="text-4xl font-bold mb-2 text-gray-900">
            {t.account.title} - APPS
          </h1>
        </div>

        <!-- Single Unified Card -->
        <div class="bg-white rounded-2xl p-8">
          <!-- User Info Section -->
          <div class="mb-8">
            <div class="flex items-center gap-2 mb-4">
              <svg
                class="w-5 h-5 text-brand-blue-500"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                ></path>
              </svg>
              <h2 class="text-xl font-semibold text-gray-900">
                {t.account.accountInfo}
              </h2>
            </div>
            <div class="space-y-2 ml-7">
              <div>
                <label
                  class="text-xs font-medium text-gray-400 uppercase tracking-wide"
                >
                  {t.account.email}
                </label>
                <p class="text-base text-gray-900 font-medium" id="user-email">
                </p>
              </div>
            </div>
          </div>

          <!-- Divider -->
          <div class="border-t border-gray-100 my-8"></div>

          <!-- Memberships Section -->
          <div class="mb-8">
            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center gap-2">
                <svg
                  class="w-5 h-5 text-brand-blue-500"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"
                  ></path>
                </svg>
                <h2 class="text-xl font-semibold text-gray-900">
                  {t.account.activeMemberships}
                </h2>
              </div>
              <button
                id="manage-all-btn"
                class="hidden bg-brand-blue-500 hover:bg-brand-blue-600 text-white font-semibold py-2.5 px-5 rounded-full transition-all gap-2 text-sm"
              >
                <svg
                  class="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                  ></path>
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                {t.account.manageAllSubscriptions}
              </button>
            </div>
            <div id="memberships-list" class="space-y-3 ml-7">
              <!-- Memberships will be loaded here -->
            </div>
            <div id="no-memberships" class="hidden text-center py-6 ml-7">
              <div class="text-5xl mb-3">ðŸ“­</div>
              <p class="text-gray-500 mb-3 text-sm">
                {t.account.noMemberships}
              </p>
            </div>
          </div>

          <!-- Divider -->
          <div class="border-t border-gray-100 my-8"></div>

          <!-- Purchased Content Section -->
          <div class="mb-8">
            <div class="flex items-center gap-2 mb-4">
              <svg
                class="w-5 h-5 text-brand-blue-500"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"
                ></path>
              </svg>
              <h2 class="text-xl font-semibold text-gray-900">
                {t.account.purchasedContent.title}
              </h2>
            </div>
            <div id="purchased-content-list" class="space-y-3 ml-7">
              <!-- Purchased content will be loaded here -->
            </div>
            <div id="no-purchased-content" class="hidden text-center py-6 ml-7">
              <div class="text-5xl mb-3">ðŸŽ¬</div>
              <p class="text-gray-500 mb-3 text-sm">
                {t.account.purchasedContent.noPurchasedContent}
              </p>
            </div>
          </div>

          <!-- Divider -->
          <div class="border-t border-gray-100 my-8"></div>

          <!-- Actions Section -->
          <div>
            <div class="flex items-center gap-2 mb-4">
              <svg
                class="w-5 h-5 text-brand-blue-500"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                ></path>
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
              <h2 class="text-xl font-semibold text-gray-900">
                {t.account.actions}
              </h2>
            </div>
            <div class="space-y-3 ml-7">
              <button
                id="logout-btn"
                class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-3.5 px-6 rounded-full transition-all flex items-center justify-center gap-2"
              >
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
                  ></path>
                </svg>
                {t.account.logout}
              </button>
              <button
                id="delete-account-btn"
                class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-3.5 px-6 rounded-full transition-all flex items-center justify-center gap-2"
              >
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                  ></path>
                </svg>
                {t.account.deleteAccount}
              </button>
            </div>
          </div>
        </div>

        <!-- Logout Modal -->
        <div
          id="logout-modal"
          class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-40 backdrop-blur-sm transition-opacity duration-200"
        >
          <div
            class="bg-white rounded-lg max-w-md w-full p-5 transform transition-all duration-200 scale-100 animate-fadeIn"
          >
            <!-- Header -->
            <div class="mb-3">
              <h3 class="text-xl font-semibold text-secondary-500">
                {t.account.logoutModal.title}
              </h3>
            </div>

            <!-- Message -->
            <div class="mb-5">
              <p class="text-gray-500 text-sm">
                {t.account.logoutModal.message}
              </p>
            </div>

            <!-- Actions -->
            <div class="flex gap-3 justify-end">
              <button
                id="modal-cancel"
                class="px-6 py-2.5 rounded-full font-semibold text-gray-600 bg-gray-100 hover:bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300"
              >
                {t.account.logoutModal.cancel}
              </button>
              <button
                id="modal-confirm"
                class="px-6 py-2.5 rounded-full font-semibold text-white bg-red-500 hover:bg-red-600 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"
              >
                {t.account.logoutModal.confirm}
              </button>
            </div>
          </div>
        </div>

        <!-- Delete Account Modal -->
        <div
          id="delete-account-modal"
          class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-40 backdrop-blur-sm transition-opacity duration-200"
        >
          <div
            class="bg-white rounded-lg max-w-md w-full p-5 transform transition-all duration-200 scale-100 animate-fadeIn"
          >
            <!-- Header -->
            <div class="mb-3">
              <h3 class="text-xl font-semibold text-red-600">
                {t.account.deleteAccountModal.title}
              </h3>
            </div>

            <!-- Message -->
            <div class="mb-3">
              <p class="text-gray-600 font-medium mb-2 text-sm">
                {t.account.deleteAccountModal.message}
              </p>
              <ul
                class="list-disc list-inside space-y-1.5 text-gray-500 mb-3 text-sm"
              >
                <li>{t.account.deleteAccountModal.warning1}</li>
                <li>{t.account.deleteAccountModal.warning2}</li>
                <li>{t.account.deleteAccountModal.warning3}</li>
              </ul>

              <!-- Email Verification -->
              <div
                class="mt-4 p-3.5 bg-gray-50 rounded-lg border border-gray-200"
              >
                <label
                  for="delete-email-verification"
                  class="block text-xs font-medium text-gray-600 mb-2"
                >
                  {t.account.deleteAccountModal.verificationLabel}
                </label>
                <p
                  id="delete-user-email-display"
                  class="text-sm font-mono mb-2.5 text-secondary-500"
                >
                </p>
                <input
                  type="email"
                  id="delete-email-verification"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent text-sm"
                  placeholder={t.account.deleteAccountModal
                    .verificationPlaceholder}
                />
              </div>
            </div>

            <!-- Actions -->
            <div class="flex gap-3 justify-end mt-5">
              <button
                id="delete-modal-cancel"
                class="px-6 py-2.5 rounded-full font-semibold text-gray-600 bg-gray-100 hover:bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300"
              >
                {t.account.deleteAccountModal.cancel}
              </button>
              <button
                id="delete-modal-confirm"
                disabled
                class="px-6 py-2.5 rounded-full font-semibold text-white bg-red-600 hover:bg-red-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-600 disabled:opacity-50 disabled:cursor-not-allowed"
              >
                {t.account.deleteAccountModal.confirm}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Not Logged In State -->
      <div id="not-logged-in" class="hidden text-center py-12">
        <div class="text-6xl mb-5">{t.account.notLoggedIn.icon}</div>
        <h1 class="text-3xl font-bold mb-3 text-gray-900">
          {t.account.notLoggedIn.title}
        </h1>
        <p class="text-base text-gray-500 mb-8">
          {t.account.notLoggedIn.message}
        </p>
        <a
          href={lang === "fr" ? "/fr/login" : "/login"}
          class="inline-block bg-brand-blue-500 hover:bg-brand-blue-600 text-white font-semibold py-3.5 px-8 rounded-full transition-all"
        >
          {t.account.notLoggedIn.loginButton}
        </a>
      </div>
    </div>
  </main>

  <Footer lang={lang} />

  <!-- Initialize the page with the external script -->
  <script>
    /* import to keep the full path for generated /fr files */
    import { initAccountPage } from "@/components/AccountCreator/account.script.ts";

    initAccountPage();
  </script>
</Layout>
