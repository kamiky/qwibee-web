---
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import LanguageSwitcher from "@/components/LanguageSwitcher.astro";
import { useTranslations } from "@/i18n/translations";

const lang = "en";
const t = useTranslations(lang);
---

<Layout
  title={t.seo.contact.title}
  description={t.seo.contact.description}
  lang={lang}
>
  <Header lang={lang} />
  <LanguageSwitcher lang={lang} />

  <main class="pt-24 pb-12 min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
    <div class="max-w-3xl mx-auto px-6">
      <div class="text-center mb-12">
        <h1 class="text-5xl sm:text-6xl font-bold mb-6 text-gray-900">
          {t.contact.title}
        </h1>
        <p class="text-xl text-gray-600">
          {t.contact.subtitle}
        </p>
      </div>

      <div
        class="bg-white border border-gray-200 rounded-2xl p-8 shadow-lg"
      >
        <!-- Success Message -->
        <div
          id="success-message"
          class="hidden mb-6 p-4 bg-green-50 border border-green-200 rounded-lg text-green-700"
        >
          <p class="font-medium">{t.contact.messages.successTitle}</p>
          <p class="text-sm mt-1">{t.contact.messages.successSubtitle}</p>
        </div>

        <!-- Error Message -->
        <div
          id="error-message"
          class="hidden mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700"
        >
          <p class="font-medium">{t.contact.messages.errorTitle}</p>
          <p class="text-sm mt-1" id="error-text"></p>
        </div>

        <form id="contact-form" class="space-y-6">
          <div>
            <label
              for="name"
              class="block text-sm font-medium text-gray-700 mb-2"
            >
              {t.contact.form.name}
            </label>
            <input
              type="text"
              id="name"
              name="name"
              class="w-full px-4 py-3 bg-white border border-gray-300 rounded-lg text-gray-900 placeholder-gray-400 focus:outline-none focus:border-brand-blue-500 focus:ring-2 focus:ring-brand-blue-500/20 transition-colors"
              placeholder={t.contact.form.namePlaceholder}
              required
            />
          </div>

          <div>
            <label
              for="email"
              class="block text-sm font-medium text-gray-700 mb-2"
            >
              {t.contact.form.email}
            </label>
            <input
              type="email"
              id="email"
              name="email"
              class="w-full px-4 py-3 bg-white border border-gray-300 rounded-lg text-gray-900 placeholder-gray-400 focus:outline-none focus:border-brand-blue-500 focus:ring-2 focus:ring-brand-blue-500/20 transition-colors"
              placeholder={t.contact.form.emailPlaceholder}
              required
            />
          </div>

          <div>
            <label
              for="message"
              class="block text-sm font-medium text-gray-700 mb-2"
            >
              {t.contact.form.message}
            </label>
            <textarea
              id="message"
              name="message"
              rows="6"
              class="w-full px-4 py-3 bg-white border border-gray-300 rounded-lg text-gray-900 placeholder-gray-400 focus:outline-none focus:border-brand-blue-500 focus:ring-2 focus:ring-brand-blue-500/20 transition-colors resize-none"
              placeholder={t.contact.form.messagePlaceholder}
              required></textarea>
          </div>

          <button
            type="submit"
            id="submit-button"
            class="w-full px-6 py-3 bg-brand-blue-500 text-white font-medium rounded-lg hover:bg-brand-blue-600 transition-all duration-300 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <span id="button-text">{t.contact.form.submit}</span>
          </button>
        </form>
      </div>
    </div>
  </main>

  <Footer lang={lang} />
</Layout>

<script define:vars={{ t }}>
  // Translation values are now available in the script
  const translations = t.contact;
  const form = document.getElementById("contact-form");
  const submitButton = document.getElementById("submit-button");
  const buttonText = document.getElementById("button-text");
  const successMessage = document.getElementById("success-message");
  const errorMessage = document.getElementById("error-message");
  const errorText = document.getElementById("error-text");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    // Hide previous messages
    successMessage.classList.add("hidden");
    errorMessage.classList.add("hidden");

    // Disable button and show loading state
    submitButton.disabled = true;
    buttonText.textContent = translations.form.sending;

    try {
      // Get form data
      const formData = new FormData(form);
      const data = {
        name: formData.get("name"),
        email: formData.get("email"),
        message: formData.get("message"),
      };

      // Send request
      const response = await fetch("/api/contact", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
      });

      const result = await response.json();

      if (response.ok) {
        // Success
        successMessage.classList.remove("hidden");
        form.reset();

        // Scroll to success message
        successMessage.scrollIntoView({ behavior: "smooth", block: "nearest" });
      } else {
        // Error
        errorText.textContent =
          result.error || translations.messages.errorDefault;
        errorMessage.classList.remove("hidden");

        // Scroll to error message
        errorMessage.scrollIntoView({ behavior: "smooth", block: "nearest" });
      }
    } catch (error) {
      // Network or other error
      errorText.textContent = translations.messages.errorNetwork;
      errorMessage.classList.remove("hidden");

      // Scroll to error message
      errorMessage.scrollIntoView({ behavior: "smooth", block: "nearest" });
    } finally {
      // Re-enable button
      submitButton.disabled = false;
      buttonText.textContent = translations.form.submit;
    }
  });
</script>
