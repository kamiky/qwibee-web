---
import LayoutCreator from "@/layouts/LayoutCreator.astro";
import { useTranslations, type Language } from "@/i18n/translations";
import { profiles, getProfileUrl } from "@/data/profiles";

const lang: Language = "en";
const t = useTranslations(lang);

// website is ready for production now
const isReadyForProduction = import.meta.env.MODE === "production" ? true : true;

// Check if we're in development mode
const isDevelopment = import.meta.env.MODE === "development";

// Get all profiles as array (excluding dev-only profiles and specific hidden profiles)
const allProfiles = Object.values(profiles).filter(p => {
  // Exclude dev-only profiles from suggestions (always, even in development)
  if (p.devonly === true) return false;
  
  // Exclude specific profiles from homepage
  if (p.id === "uh29p8bf") return false;
  
  return true;
});

// Randomly select 3 creators
const shuffled = [...allProfiles].sort(() => Math.random() - 0.5);
const randomCreators = shuffled.slice(0, 3);

// Get profile1 avatar for hero images
const profile1Avatar = "/home/avatar1.jpg";
const profile2Avatar = "/home/avatar2.jpg";
const profile3Avatar = "/home/avatar3.jpg";
---

<LayoutCreator
  title={t.seo.home.title}
  description={t.seo.home.description}
  lang={lang}
>
  {!isReadyForProduction ? (
    <main class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center">
      <div class="text-center px-6">
        <h1 class="text-4xl font-bold text-gray-900 mb-4">Please wait, website is not ready for production yet...</h1>
      </div>
    </main>
  ) : (
    <>
      <main class="min-h-screen bg-gradient-to-br from-gray-50 via-blue-50/30 to-gray-100">
    <!-- Hero Section -->
    <section class="pt-32 pb-20 px-6">
      <div class="max-w-7xl mx-auto">
        <div class="grid lg:grid-cols-2 gap-12 items-center">
          <!-- Mobile: Images First (Above Text) -->
          <div class="lg:hidden relative flex items-center justify-center mb-8">
            <div class="relative w-full h-[300px] flex items-center justify-center gap-3">
              <!-- Image 1 - Left (smaller on mobile) -->
              <div
                class="relative w-24 h-36 sm:w-32 sm:h-48 rounded-2xl overflow-hidden shadow-xl transform -rotate-6 transition-transform duration-300 hover:rotate-0 hover:scale-105"
              >
                <img
                  src={profile1Avatar}
                  alt="Creator 1"
                  class="w-full h-full object-cover"
                />
              </div>

              <!-- Image 2 - Center (larger on mobile) -->
              <div
                class="relative w-32 h-48 sm:w-40 sm:h-60 rounded-2xl overflow-hidden shadow-xl z-10 transition-transform duration-300 hover:scale-110"
              >
                <img
                  src={profile2Avatar}
                  alt="Creator 2"
                  class="w-full h-full object-cover"
                />
              </div>

              <!-- Image 3 - Right (smaller on mobile) -->
              <div
                class="relative w-24 h-36 sm:w-32 sm:h-48 rounded-2xl overflow-hidden shadow-xl transform rotate-6 transition-transform duration-300 hover:rotate-0 hover:scale-105"
              >
                <img
                  src={profile3Avatar}
                  alt="Creator 3"
                  class="w-full h-full object-cover"
                />
              </div>
            </div>
          </div>

          <!-- Text Content -->
          <div class="space-y-8 text-center lg:text-left">
            <h1
              class="text-4xl sm:text-5xl lg:text-6xl font-bold text-gray-900 leading-tight tracking-tight"
            >
              {lang === 'fr' ? 'Inscrivez-vous pour soutenir vos cr√©ateurs pr√©f√©r√©s' : 'Sign up to support your favorite creators'}
            </h1>
            <p
              class="text-lg sm:text-xl text-gray-600 leading-relaxed max-w-xl mx-auto lg:mx-0 font-light"
            >
              {lang === 'fr' ? 'Rejoignez Qwibee et acc√©dez √† du contenu exclusif de vos cr√©ateurs pr√©f√©r√©s.' : 'Join Qwibee and access exclusive content from your favorite creators.'}
            </p>
            <div class="flex justify-center lg:justify-start">
              <a
                href="/login"
                class="inline-block bg-brand-blue-500 hover:bg-brand-blue-600 text-white font-semibold py-4 px-8 rounded-full transition-all transform hover:scale-105 shadow-lg hover:shadow-xl duration-200"
              >
                {lang === 'fr' ? 'S\'inscrire' : 'Sign Up'}
              </a>
            </div>
          </div>

          <!-- Desktop: Images on Right (Original Layout) -->
          <div class="hidden lg:flex relative items-center justify-center">
            <div
              class="relative w-full h-[600px] flex items-center justify-end gap-6"
            >
              <!-- Image 1 - Left -->
              <div
                class="relative w-64 h-96 rounded-3xl overflow-hidden shadow-2xl transform -rotate-6 hover:rotate-0 transition-transform duration-300"
              >
                <img
                  src={profile1Avatar}
                  alt="Creator 1"
                  class="w-full h-full object-cover"
                />
              </div>

              <!-- Image 2 - Center (larger) -->
              <div
                class="relative w-72 h-[500px] rounded-3xl overflow-hidden shadow-2xl z-10 hover:scale-105 transition-transform duration-300"
              >
                <img
                  src={profile2Avatar}
                  alt="Creator 2"
                  class="w-full h-full object-cover"
                />
              </div>

              <!-- Image 3 - Right -->
              <div
                class="relative w-64 h-96 rounded-3xl overflow-hidden shadow-2xl transform rotate-6 hover:rotate-0 transition-transform duration-300"
              >
                <img
                  src={profile3Avatar}
                  alt="Creator 3"
                  class="w-full h-full object-cover"
                />
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    

    <!-- Explore Creators Section -->
    <section id="creators" class="py-20 px-6 bg-white/80 backdrop-blur-sm">
      <div class="max-w-7xl mx-auto">
        <div class="text-center mb-16">
          <h2
            class="text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-900 mb-4 tracking-tight"
          >
            Explore
          </h2>
          <p class="text-gray-600 text-lg max-w-2xl mx-auto">
            Discover amazing creators and their content
          </p>
        </div>

        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
          {
            randomCreators.map((profile) => (
              <a
                href={getProfileUrl(profile.id, lang)}
                class="group bg-white border border-gray-200 rounded-2xl overflow-hidden hover:border-brand-blue-500 hover:shadow-2xl transition-all duration-300 hover:transform hover:-translate-y-2"
              >
                <div class="aspect-square bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center overflow-hidden">
                  {profile.avatar ? (
                    <img
                      src={profile.avatar}
                      alt={profile.displayName[lang]}
                      class="w-full h-full object-cover object-top group-hover:scale-110 transition-transform duration-500"
                    />
                  ) : (
                    <div class="text-6xl">üë§</div>
                  )}
                </div>
                <div class="p-6">
                  <h3 class="text-xl font-bold mb-2 text-gray-900 group-hover:text-brand-blue-500 transition-colors">
                    {profile.displayName[lang]}
                  </h3>
                  {/* <p class="text-gray-600 mb-4 line-clamp-2">
                    {profile.bio[lang]}
                  </p> */}
                  <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-500 font-medium">
                      {profile.videos.length} {t.profile.videos}
                    </span>
                    {profile.membershipPrice !== undefined && (
                      <span class="text-brand-blue-500 font-semibold">
                        {profile.membershipPrice === 0 
                          ? "Free" 
                          : `$${(profile.membershipPrice / 100).toFixed(2)}${t.profile.perMonth}`
                        }
                      </span>
                    )}
                  </div>
                </div>
              </a>
            ))
          }
        </div>
      </div>
    </section>

<!-- Creator Contact Form Section - COMMENTED OUT FOR NOW -->
    <!--
    <section id="creator-contact" class="py-20 px-6 bg-gradient-to-br from-gray-50 to-blue-50/30">
      <div class="max-w-3xl mx-auto">
        <div class="text-center mb-12">
          <h2
            class="text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-900 mb-4 tracking-tight"
          >
            {t.creatorContact.title}
          </h2>
          <p class="text-lg sm:text-xl text-gray-600 max-w-2xl mx-auto font-light">
            {t.creatorContact.subtitle}
          </p>
        </div>

        <div
          id="creator-contact-form-container"
          class="bg-white rounded-2xl shadow-xl p-6 sm:p-8 border border-gray-100"
        >
          <form id="creator-contact-form" class="space-y-6">
            <div>
              <label
                for="creator-name"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                {t.creatorContact.form.name}
              </label>
              <input
                type="text"
                id="creator-name"
                name="name"
                required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-blue-500 focus:border-transparent transition-all font-rubik"
                placeholder={t.creatorContact.form.namePlaceholder}
              />
            </div>

            <div>
              <label
                for="creator-email"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                {t.creatorContact.form.email}
              </label>
              <input
                type="email"
                id="creator-email"
                name="email"
                required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-blue-500 focus:border-transparent transition-all font-rubik"
                placeholder={t.creatorContact.form.emailPlaceholder}
              />
            </div>

            <div>
              <label
                for="creator-job"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                {t.creatorContact.form.job}
              </label>
              <input
                type="text"
                id="creator-job"
                name="job"
                required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-blue-500 focus:border-transparent transition-all font-rubik"
                placeholder={t.creatorContact.form.jobPlaceholder}
              />
            </div>

            <div>
              <label
                for="creator-product-type"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                {t.creatorContact.form.productType}
              </label>
              <textarea
                id="creator-product-type"
                name="productType"
                required
                rows="4"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-blue-500 focus:border-transparent transition-all resize-none font-rubik"
                placeholder={t.creatorContact.form.productTypePlaceholder}
              ></textarea>
            </div>

            <div>
              <button
                type="submit"
                id="creator-submit-btn"
                class="w-full bg-brand-blue-500 hover:bg-brand-blue-600 text-white font-semibold py-4 px-8 rounded-full transition-all transform hover:scale-105 shadow-lg hover:shadow-xl duration-200"
              >
                {t.creatorContact.form.submit}
              </button>
            </div>
          </form>

          <div
            id="creator-success-message"
            class="hidden text-center space-y-4"
          >
            <div class="text-green-600 text-5xl">‚úì</div>
            <h3 class="text-2xl font-bold text-gray-900">
              {t.creatorContact.messages.successTitle}
            </h3>
            <p class="text-gray-600">
              {t.creatorContact.messages.successSubtitle}
            </p>
          </div>

          <div
            id="creator-error-message"
            class="hidden bg-red-50 border border-red-200 rounded-lg p-4"
          >
            <div class="flex items-start">
              <div class="text-red-600 text-xl mr-3">‚úó</div>
              <div>
                <h4 class="font-semibold text-red-900">
                  {t.creatorContact.messages.errorTitle}
                </h4>
                <p id="creator-error-text" class="text-red-700 text-sm mt-1">
                  {t.creatorContact.messages.errorDefault}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    -->
      </main>

      <script is:inline>
    document.addEventListener("DOMContentLoaded", function() {
      // Smooth scroll for anchor links
      document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
        anchor.addEventListener("click", (e) => {
          e.preventDefault();
          const href = anchor.getAttribute("href");
          if (href) {
            const target = document.querySelector(href);
            if (target) {
              target.scrollIntoView({
                behavior: "smooth",
                block: "start",
              });
            }
          }
        });
      });

      // Creator Contact Form Handler - COMMENTED OUT
      /*
      const creatorForm = document.getElementById("creator-contact-form");
      const creatorSubmitBtn = document.getElementById("creator-submit-btn");
      const creatorSuccessMessage = document.getElementById("creator-success-message");
      const creatorErrorMessage = document.getElementById("creator-error-message");
      const creatorErrorText = document.getElementById("creator-error-text");

      console.log("Creator form found:", creatorForm);
      console.log("Submit button found:", creatorSubmitBtn);

      if (creatorForm && creatorSubmitBtn) {
        creatorForm.addEventListener("submit", async (e) => {
          e.preventDefault();
          e.stopPropagation();

          console.log("Form submitted via JavaScript");

          // Hide any previous messages
          if (creatorSuccessMessage) creatorSuccessMessage.classList.add("hidden");
          if (creatorErrorMessage) creatorErrorMessage.classList.add("hidden");

          // Get form data
          const formData = new FormData(creatorForm);
          const data = {
            name: formData.get("name"),
            email: formData.get("email"),
            job: formData.get("job"),
            productType: formData.get("productType"),
          };

          console.log("Form data:", data);

          // Disable submit button and show loading state
          creatorSubmitBtn.disabled = true;
          const originalButtonText = creatorSubmitBtn.textContent;
          creatorSubmitBtn.textContent = "Sending...";

          try {
            console.log("Sending request to /api/contact/creator");
            const response = await fetch("/api/contact/creator", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(data),
            });

            console.log("Response status:", response.status);
            const result = await response.json();
            console.log("Response result:", result);

            if (response.ok) {
              // Show success message
              creatorForm.classList.add("hidden");
              if (creatorSuccessMessage) creatorSuccessMessage.classList.remove("hidden");
              
              // Reset form
              creatorForm.reset();
            } else {
              // Show error message
              if (creatorErrorMessage && creatorErrorText) {
                creatorErrorText.textContent = result.error || "Failed to send application. Please try again.";
                creatorErrorMessage.classList.remove("hidden");
              }
            }
          } catch (error) {
            console.error("Error submitting creator contact form:", error);
            // Show error message
            if (creatorErrorMessage && creatorErrorText) {
              creatorErrorText.textContent = "Network error. Please check your connection and try again.";
              creatorErrorMessage.classList.remove("hidden");
            }
          } finally {
            // Re-enable submit button and restore original text
            creatorSubmitBtn.disabled = false;
            if (originalButtonText) creatorSubmitBtn.textContent = originalButtonText;
          }
        });

        console.log("Form submit event listener attached");
      } else {
        console.error("Form or submit button not found!");
      }
      */
    });
      </script>
    </>
  )}
</LayoutCreator>
