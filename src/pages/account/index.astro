---
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import LanguageSwitcher from "@/components/LanguageSwitcher.astro";
import { useTranslations, type Language } from "@/i18n/translations";

// Detect language from URL path
const pathname = Astro.url.pathname;
const lang: Language =
  pathname.startsWith("/fr/") ||
  pathname === "/fr" ||
  pathname.startsWith("/fr/account")
    ? "fr"
    : "en";
const t = useTranslations(lang);
---

<Layout
  title={t.seo.account.title}
  description={t.seo.account.description}
  lang={lang}
>
  <Header lang={lang} />
  <LanguageSwitcher lang={lang} />

  <main
    class="pt-24 pb-12 min-h-screen bg-gradient-to-br from-gray-50 to-gray-100"
  >
    <div class="max-w-4xl mx-auto px-6">
      <!-- Loading State -->
      <div id="loading-container" class="text-center py-12">
        <div
          class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-brand-blue-500 mb-4"
        >
        </div>
        <p class="text-gray-600">{t.account.loading}</p>
      </div>

      <!-- Account Info -->
      <div id="account-container" class="hidden">
        <!-- Header -->
        <div class="mb-8">
          <h1 class="text-4xl font-extrabold mb-2 text-gray-900">
            {t.account.title}
          </h1>
          <p class="text-xl text-gray-600">{t.account.subtitle}</p>
        </div>

        <!-- User Info Card -->
        <div
          class="bg-white rounded-2xl p-8 border border-gray-200 shadow-lg mb-6"
        >
          <h2 class="text-2xl font-bold mb-4 text-gray-900">
            {t.account.accountInfo}
          </h2>
          <div class="space-y-3">
            <div>
              <label class="text-sm font-medium text-gray-600"
                >{t.account.email}</label
              >
              <p class="text-lg text-gray-900" id="user-email"></p>
            </div>
          </div>
        </div>

        <!-- Memberships Card -->
        <div
          class="bg-white rounded-2xl p-8 border border-gray-200 shadow-lg mb-6"
        >
          <h2 class="text-2xl font-bold mb-4 text-gray-900">
            {t.account.activeMemberships}
          </h2>
          <div id="memberships-list" class="space-y-4">
            <!-- Memberships will be loaded here -->
          </div>
          <div id="no-memberships" class="hidden text-center py-8">
            <div class="text-6xl mb-4">ðŸ“­</div>
            <p class="text-gray-600 mb-4">{t.account.noMemberships}</p>
            <a
              href={lang === "fr" ? "/fr" : "/"}
              class="text-brand-blue-500 hover:text-brand-blue-600 font-semibold"
            >
              {t.account.browseCreators}
            </a>
          </div>
        </div>

        <!-- Purchased Content Card -->
        <div
          class="bg-white rounded-2xl p-8 border border-gray-200 shadow-lg mb-6"
        >
          <h2 class="text-2xl font-bold mb-4 text-gray-900">
            {t.account.purchasedContent.title}
          </h2>
          <div id="purchased-content-list" class="space-y-4">
            <!-- Purchased content will be loaded here -->
          </div>
          <div id="no-purchased-content" class="hidden text-center py-8">
            <div class="text-6xl mb-4">ðŸŽ¬</div>
            <p class="text-gray-600 mb-4">
              {t.account.purchasedContent.noPurchasedContent}
            </p>
            <a
              href={lang === "fr" ? "/fr" : "/"}
              class="text-brand-blue-500 hover:text-brand-blue-600 font-semibold"
            >
              {t.account.purchasedContent.browseCreators}
            </a>
          </div>
        </div>

        <!-- Actions -->
        <div class="bg-white rounded-2xl p-8 border border-gray-200 shadow-lg">
          <h2 class="text-2xl font-bold mb-4 text-gray-900">
            {t.account.actions}
          </h2>
          <div class="space-y-3">
            <button
              id="logout-btn"
              class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors"
            >
              {t.account.logout}
            </button>
            <button
              id="delete-account-btn"
              class="w-full bg-gray-700 hover:bg-gray-800 text-white font-semibold py-3 px-6 rounded-lg transition-colors"
            >
              {t.account.deleteAccount}
            </button>
          </div>
        </div>

        <!-- Logout Modal -->
        <div
          id="logout-modal"
          class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 backdrop-blur-sm transition-opacity duration-200"
        >
          <div
            class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 transform transition-all duration-200 scale-100 animate-fadeIn"
          >
            <!-- Header -->
            <div class="mb-4">
              <h3 class="text-2xl font-bold text-gray-900">
                {t.account.logoutModal.title}
              </h3>
            </div>

            <!-- Message -->
            <div class="mb-6">
              <p class="text-gray-600 text-lg">
                {t.account.logoutModal.message}
              </p>
            </div>

            <!-- Actions -->
            <div class="flex gap-3 justify-end">
              <button
                id="modal-cancel"
                class="px-6 py-2.5 rounded-lg font-semibold text-gray-700 bg-gray-100 hover:bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300"
              >
                {t.account.logoutModal.cancel}
              </button>
              <button
                id="modal-confirm"
                class="px-6 py-2.5 rounded-lg font-semibold text-white bg-red-500 hover:bg-red-600 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"
              >
                {t.account.logoutModal.confirm}
              </button>
            </div>
          </div>
        </div>

        <!-- Delete Account Modal -->
        <div
          id="delete-account-modal"
          class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 backdrop-blur-sm transition-opacity duration-200"
        >
          <div
            class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 transform transition-all duration-200 scale-100 animate-fadeIn"
          >
            <!-- Header -->
            <div class="mb-4">
              <h3 class="text-2xl font-bold text-red-600">
                {t.account.deleteAccountModal.title}
              </h3>
            </div>

            <!-- Message -->
            <div class="mb-4">
              <p class="text-gray-700 font-semibold mb-3">
                {t.account.deleteAccountModal.message}
              </p>
              <ul class="list-disc list-inside space-y-2 text-gray-600 mb-4">
                <li>{t.account.deleteAccountModal.warning1}</li>
                <li>{t.account.deleteAccountModal.warning2}</li>
                <li>{t.account.deleteAccountModal.warning3}</li>
              </ul>

              <!-- Email Verification -->
              <div
                class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200"
              >
                <label
                  for="delete-email-verification"
                  class="block text-sm font-semibold text-gray-700 mb-2"
                >
                  {t.account.deleteAccountModal.verificationLabel}
                </label>
                <p
                  id="delete-user-email-display"
                  class="text-sm font-mono mb-3 text-gray-900"
                >
                </p>
                <input
                  type="email"
                  id="delete-email-verification"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"
                  placeholder={t.account.deleteAccountModal
                    .verificationPlaceholder}
                />
              </div>
            </div>

            <!-- Actions -->
            <div class="flex gap-3 justify-end mt-6">
              <button
                id="delete-modal-cancel"
                class="px-6 py-2.5 rounded-lg font-semibold text-gray-700 bg-gray-100 hover:bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300"
              >
                {t.account.deleteAccountModal.cancel}
              </button>
              <button
                id="delete-modal-confirm"
                disabled
                class="px-6 py-2.5 rounded-lg font-semibold text-white bg-red-600 hover:bg-red-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-600 disabled:opacity-50 disabled:cursor-not-allowed"
              >
                {t.account.deleteAccountModal.confirm}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Not Logged In State -->
      <div id="not-logged-in" class="hidden text-center py-12">
        <div class="text-6xl mb-6">{t.account.notLoggedIn.icon}</div>
        <h1 class="text-3xl font-bold mb-4 text-gray-900">
          {t.account.notLoggedIn.title}
        </h1>
        <p class="text-xl text-gray-600 mb-8">
          {t.account.notLoggedIn.message}
        </p>
        <a
          href={lang === "fr" ? "/fr/login" : "/login"}
          class="inline-block bg-brand-blue-500 hover:bg-brand-blue-600 text-white font-bold py-3 px-8 rounded-lg transition-colors shadow-lg"
        >
          {t.account.notLoggedIn.loginButton}
        </a>
      </div>
    </div>
  </main>

  <Footer lang={lang} />

  <!-- Initialize the page with the external script -->
  <script>
    /* import to keep the full path for generated /fr files */
    import { initAccountPage } from "@/pages/account/account.script.ts";

    initAccountPage();
  </script>
</Layout>
