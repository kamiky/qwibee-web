---
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import LanguageSwitcher from "@/components/LanguageSwitcher.astro";
import { useTranslations, type Language } from "@/i18n/translations";

// Detect language from URL path
const pathname = Astro.url.pathname;
const lang: Language =
  pathname.startsWith("/fr/") ||
  pathname === "/fr" ||
  pathname.startsWith("/fr/account")
    ? "fr"
    : "en";
const t = useTranslations(lang);
---

<Layout
  title={t.seo.account.title}
  description={t.seo.account.description}
  lang={lang}
>
  <Header lang={lang} />
  <LanguageSwitcher lang={lang} />

  <main class="pt-24 pb-12 min-h-screen bg-gray-50">
    <div class="max-w-4xl mx-auto px-6">
      <!-- Loading State -->
      <div id="loading-container" class="text-center py-12">
        <div
          class="inline-block animate-spin rounded-full h-10 w-10 border-b-2 border-brand-blue-500 mb-3"
        >
        </div>
        <p class="text-gray-500 text-sm">{t.account.loading}</p>
      </div>

      <!-- Account Info -->
      <div id="account-container" class="hidden">
        <!-- Header -->
        <div class="mb-6">
          <h1 class="text-3xl font-semibold mb-1.5 text-secondary-500">
            {t.account.title}
          </h1>
          <p class="text-base text-gray-500">{t.account.subtitle}</p>
        </div>

        <!-- User Info Card -->
        <div class="bg-white rounded-lg p-6 border border-gray-200 mb-5">
          <h2 class="text-xl font-medium mb-3 text-secondary-500">
            {t.account.accountInfo}
          </h2>
          <div class="space-y-2">
            <div>
              <label
                class="text-xs font-medium text-gray-400 uppercase tracking-wide"
                >{t.account.email}</label
              >
              <p class="text-base text-secondary-500" id="user-email"></p>
            </div>
          </div>
        </div>

        <!-- Memberships Card -->
        <div class="bg-white rounded-lg p-6 border border-gray-200 mb-5">
          <h2 class="text-xl font-medium mb-3 text-secondary-500">
            {t.account.activeMemberships}
          </h2>
          <div id="memberships-list" class="space-y-3">
            <!-- Memberships will be loaded here -->
          </div>
          <div id="no-memberships" class="hidden text-center py-6">
            <div class="text-5xl mb-3">ðŸ“­</div>
            <p class="text-gray-500 mb-3 text-sm">{t.account.noMemberships}</p>
            <a
              href={lang === "fr" ? "/fr" : "/"}
              class="text-brand-blue-500 hover:text-brand-blue-600 font-medium text-sm"
            >
              {t.account.browseCreators}
            </a>
          </div>
        </div>

        <!-- Purchased Content Card -->
        <div class="bg-white rounded-lg p-6 border border-gray-200 mb-5">
          <h2 class="text-xl font-medium mb-3 text-secondary-500">
            {t.account.purchasedContent.title}
          </h2>
          <div id="purchased-content-list" class="space-y-3">
            <!-- Purchased content will be loaded here -->
          </div>
          <div id="no-purchased-content" class="hidden text-center py-6">
            <div class="text-5xl mb-3">ðŸŽ¬</div>
            <p class="text-gray-500 mb-3 text-sm">
              {t.account.purchasedContent.noPurchasedContent}
            </p>
            <a
              href={lang === "fr" ? "/fr" : "/"}
              class="text-brand-blue-500 hover:text-brand-blue-600 font-medium text-sm"
            >
              {t.account.purchasedContent.browseCreators}
            </a>
          </div>
        </div>

        <!-- Actions -->
        <div class="bg-white rounded-lg p-6 border border-gray-200">
          <h2 class="text-xl font-medium mb-3 text-secondary-500">
            {t.account.actions}
          </h2>
          <div class="space-y-2.5">
            <button
              id="logout-btn"
              class="w-full bg-red-500 hover:bg-red-600 text-white font-medium py-2.5 px-5 rounded-lg transition-colors"
            >
              {t.account.logout}
            </button>
            <button
              id="delete-account-btn"
              class="w-full bg-secondary-500 hover:bg-secondary-600 text-white font-medium py-2.5 px-5 rounded-lg transition-colors"
            >
              {t.account.deleteAccount}
            </button>
          </div>
        </div>

        <!-- Logout Modal -->
        <div
          id="logout-modal"
          class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-40 backdrop-blur-sm transition-opacity duration-200"
        >
          <div
            class="bg-white rounded-lg max-w-md w-full p-5 transform transition-all duration-200 scale-100 animate-fadeIn"
          >
            <!-- Header -->
            <div class="mb-3">
              <h3 class="text-xl font-semibold text-secondary-500">
                {t.account.logoutModal.title}
              </h3>
            </div>

            <!-- Message -->
            <div class="mb-5">
              <p class="text-gray-500 text-sm">
                {t.account.logoutModal.message}
              </p>
            </div>

            <!-- Actions -->
            <div class="flex gap-2.5 justify-end">
              <button
                id="modal-cancel"
                class="px-5 py-2 rounded-lg font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300"
              >
                {t.account.logoutModal.cancel}
              </button>
              <button
                id="modal-confirm"
                class="px-5 py-2 rounded-lg font-medium text-white bg-red-500 hover:bg-red-600 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"
              >
                {t.account.logoutModal.confirm}
              </button>
            </div>
          </div>
        </div>

        <!-- Delete Account Modal -->
        <div
          id="delete-account-modal"
          class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-40 backdrop-blur-sm transition-opacity duration-200"
        >
          <div
            class="bg-white rounded-lg max-w-md w-full p-5 transform transition-all duration-200 scale-100 animate-fadeIn"
          >
            <!-- Header -->
            <div class="mb-3">
              <h3 class="text-xl font-semibold text-red-600">
                {t.account.deleteAccountModal.title}
              </h3>
            </div>

            <!-- Message -->
            <div class="mb-3">
              <p class="text-gray-600 font-medium mb-2 text-sm">
                {t.account.deleteAccountModal.message}
              </p>
              <ul
                class="list-disc list-inside space-y-1.5 text-gray-500 mb-3 text-sm"
              >
                <li>{t.account.deleteAccountModal.warning1}</li>
                <li>{t.account.deleteAccountModal.warning2}</li>
                <li>{t.account.deleteAccountModal.warning3}</li>
              </ul>

              <!-- Email Verification -->
              <div
                class="mt-4 p-3.5 bg-gray-50 rounded-lg border border-gray-200"
              >
                <label
                  for="delete-email-verification"
                  class="block text-xs font-medium text-gray-600 mb-2"
                >
                  {t.account.deleteAccountModal.verificationLabel}
                </label>
                <p
                  id="delete-user-email-display"
                  class="text-sm font-mono mb-2.5 text-secondary-500"
                >
                </p>
                <input
                  type="email"
                  id="delete-email-verification"
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent text-sm"
                  placeholder={t.account.deleteAccountModal
                    .verificationPlaceholder}
                />
              </div>
            </div>

            <!-- Actions -->
            <div class="flex gap-2.5 justify-end mt-5">
              <button
                id="delete-modal-cancel"
                class="px-5 py-2 rounded-lg font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300"
              >
                {t.account.deleteAccountModal.cancel}
              </button>
              <button
                id="delete-modal-confirm"
                disabled
                class="px-5 py-2 rounded-lg font-medium text-white bg-red-600 hover:bg-red-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-600 disabled:opacity-50 disabled:cursor-not-allowed"
              >
                {t.account.deleteAccountModal.confirm}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Not Logged In State -->
      <div id="not-logged-in" class="hidden text-center py-12">
        <div class="text-5xl mb-5">{t.account.notLoggedIn.icon}</div>
        <h1 class="text-2xl font-semibold mb-3 text-secondary-500">
          {t.account.notLoggedIn.title}
        </h1>
        <p class="text-base text-gray-500 mb-6">
          {t.account.notLoggedIn.message}
        </p>
        <a
          href={lang === "fr" ? "/fr/login" : "/login"}
          class="inline-block bg-brand-blue-500 hover:bg-brand-blue-600 text-white font-medium py-2.5 px-6 rounded-lg transition-colors"
        >
          {t.account.notLoggedIn.loginButton}
        </a>
      </div>
    </div>
  </main>

  <Footer lang={lang} />

  <!-- Initialize the page with the external script -->
  <script>
    /* import to keep the full path for generated /fr files */
    import { initAccountPage } from "@/pages/account/account.script.ts";

    initAccountPage();
  </script>
</Layout>
